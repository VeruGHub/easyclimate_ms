---
title: "The easyclimate R package: easy access to high-resolution daily climate data for Europe"

# subtitle: "Short title: easyclimate R package"

author: "Verónica Cruz-Alonso (ORCID: 0000-0002-0642-036X) ^1,2^ §, 
    Christoph Pucher (ORCID: 0000-0002-9269-1907) ^3^ §, 
    Sophia Ratcliffe (ORCID: 0000-0001-9284-7900) ^4^,
    Paloma Ruiz-Benito (ORCID: 0000-0002-2781-5870) ^2^,
    Julen Astigarraga (ORCID: 0000-0001-9520-3713) ^2^,
    Mathias Neumann (ORCID: 0000-0003-2472-943X) ^3^
    Francisco Rodríguez-Sánchez (ORCID: 0000-0002-7981-1599) ^5,6^"

# date: `r Sys.Date()`

output:
  bookdown::word_document2:
    fig_caption: yes
    fig_width: 7
    fig_height: 7
    df_print: kable
    keep_md: no
    number_sections: no
    toc: no
    reference_docx: Word_template.docx
    
bibliography: 
  - references.bib
  - knitcitations.bib
csl: journal-of-vegetation-science.csl
# csl: https://www.zotero.org/styles/ecology
---

^1^ Department of Landscape Architecture, Graduate School of Design, Harvard University, Cambridge,

^2^ Grupo de Ecología Forestal y Restauración (FORECO), Universidad de Alcalá, Spain

^3^ Boku

^4^ National Biodiversity network

^5^ Departamento de Biología Vegetal y Ecología, Universidad de Sevilla, Spain.

^6^ Estación Biológica de Doñana, Consejo Superior de Investigaciones Científicas, Spain.

§ These authors share the first-author position.

Correspondence:

Verónica Cruz-Alonso, Harvard University, Cambridge, MA, USA. Email: [veronica.cral\@gmail.com](mailto:veronica.cral@gmail.com){.email}

# FUNDING INFORMATION

VCA was supported by the Real Colegio Complutense Postdoctoral Fellowship 2020 and XXX. FRS was supported by the VI Plan Propio de Investigación of Universidad de Sevilla (VI PPIT-US).

# ABSTRACT

Write your abstract here (200 WORDS MAXIMUM)

*Keywords*: R package, climate, Europe, reproducibility, cloud-optimised geotiffs, (8-12 KEYWORDS)

```{r setup, include=FALSE, cache=FALSE, message = FALSE}

library("knitr")

### Chunk options: see http://yihui.name/knitr/options/ ###
## Text results
opts_chunk$set(echo = FALSE, warning = TRUE, message = TRUE)

## Code decoration
opts_chunk$set(tidy = TRUE, comment = NA, highlight = TRUE)

## Cache
# opts_chunk$set(cache = 2, cache.path = "output/cache/")

## Plots
opts_chunk$set(fig.path = "output/figures/", dpi = 300)

```

```{r knitcitations, cache = FALSE}
library(knitcitations)
cleanbib()   
cite_options(citation_format = "pandoc")
```

# INTRODUCTION

In this paper we present *easyclimate* a package to process and download climatic data with R [@Rcoreteam] available available from the Comprehensive R Archive Network (CRAN; link). In the last decades, ecological science and application has experienced an increasing demand of harmonized climatic data at wide spatial scales and spanning long temporal series (REF). In this context, *easyclimate* has been developed to facilitate the downloading and processing of high-resolution (1 km\^2) daily climate data (precipitation, minimum and maximum temperatures) for Europe. Data are currently available from 1950 to 2020 and hosted at [University of Natural Resources and Life Sciences, Vienna, Austria](https://boku.ac.at/en/wabo/waldbau/wir-ueber-uns/daten). This climatic dataset was originally built by Moreno & Hasenauer [@Moreno&Hasenauer2015] and further developed by W. Rammer, C. Pucher & M. Neumann. For this R package we implemented Cloud-Optimised Geotiffs so that the user can obtain daily climate data for thousands of sites and days within minutes, without having to download huge rasters.

# FUNCTIONALITY

The main function in *easyclimate* is *get_daily_climate*, which extracts daily climate data for a given set of coordinates (points or polygons) and a given period of days or years (see examples in *get_daily_climate* [help page](https://verughub.github.io/easyclimate/reference/get_daily_climate.html), and the vignettes [Analysing the climate at spatial points for a given period](https://verughub.github.io/easyclimate/articles/points-df-mat-sf.html) and [Analysing the climate of an area for a given period](https://verughub.github.io/easyclimate/articles/polygons-raster.html)). The output can be either a dataframe (\@ref(tab:Table-1)) or a raster (\@ref(fig:Fig-1)) with daily climatic values for each point or polygon.

```{r example, echo=TRUE, message=FALSE}
library(easyclimate)

coords <- matrix(c(-5.36, 37.40), ncol = 2)

prec <- get_daily_climate(coords, 
                          period = "2001-01-01:2001-01-03", 
                          climatic_var = "Prcp")
```

```{r echo=TRUE, message=FALSE}
library(terra)

coords_poly <- vect("POLYGON ((-4.5 41, -4.5 40.5, -5 40.5, -5 41))")

ras_tmax <- get_daily_climate(
  coords_poly,
  period = c("2012-01-01", "2012-08-01"),
  climatic_var = "Tmax",
  output = "raster" # return raster
  )

```

Additionally, *easyclimate* yields tidy datasets that allow the calculation of climatic variables following the [tidyverse](https://www.tidyverse.org/) philosophy. In the next example we download daily climatic data for a specific location, a five-year period and store it in a dataframe.

```{r}
library(easyclimate)
library(dplyr)

coords <- matrix(c(-4.88, 40.82), ncol = 2)

prec <- get_daily_climate(coords, 
                          period = 2010:2015,
                          climatic_var = "Prcp")  

tmin <- get_daily_climate(coords, 
                          period = 2010:2015,
                          climatic_var = "Tmin")

tmax <- get_daily_climate(coords, 
                          period = 2010:2015,
                          climatic_var = "Tmax")

daily <- prec %>% 
  full_join(tmin) %>% 
  full_join(tmax) 

```

Temperature and precipitation units are ºC × 100 and mm × 100, respectively, to avoid floating values. Here we convert them to ºC and mm, and calculate the daily mean temperature:

```{r}
realvalue <- function(x) {x/100}

daily <- daily %>% 
  mutate(across(c(Prcp, Tmin, Tmax), realvalue)) %>%
  mutate(Tmean = (Tmin + Tmax) / 2, #Daily mean temperature
         date = as.Date(date),
         month = format(date, format = "%m"),
         year = format(date, format = "%Y"))
```

To calculate average temperatures and accumulated precipitation by site or time period (\@ref(tab:Table-2)) we can use `group_by` and `summarise` from `dplyr`, or `by` and `aggregate` from base R:

```{r}

yearclimate <- daily %>% 
  group_by(year) %>% 
  summarise(Tmin.year = mean(Tmin),
            Tmean.year = mean(Tmean),
            Tmax.year = mean(Tmax),
            Prcp.year = sum(Prcp)) 
```

The results of the package *easyclimate* can be used directly or with simple calculations as the shown previously as input of other packages to calculate climatic variables (e.g. [climInd](https://cran.r-project.org/web/packages/ClimInd/index.html), [SPEI](https://cran.r-project.org/web/packages/SPEI/index.html)).

# SAVINGS IN TIME

Example of script to download the rasters and extract values for a polygon or come points and the time needed. Same with easyclimate.

# APPLICATIONS IN PLANT SCIENCES

Having daily climatic values allows to extensively characterize important factors that condition plant performance such as the late-spring frosts or intensity, length of heat waves during the summer or days without precipitation. These information is not easily available, less still harmonized at large spatial scales. In the next example we show how to calculate the number of days with temperature below zero in spring per year and the mean minimum temperature reached (\@ref(tab:Table-2); see ["Calculating basic climatic indices with data from easyclimate"](Calculating basic climatic indices with data from easyclimate) vignette for other examples).

```{r}

spring.months <- c("03","04","05") # March to May

springfrost <- daily %>% 
  mutate(ID_coords = as.factor(ID_coords),
         year = factor(year)) %>% 
  filter(month %in% spring.months) %>% 
  mutate(event = ifelse(Tmin < 0, 1, 0)) %>% # NAs will be 0 
  group_by(ID_coords, year) %>% 
  mutate(n_frost = sum(event)) %>% # No. of days with minimum temperature < 0 per year
  filter(event == 1) %>% 
  group_by(ID_coords, year, n_frost) %>% 
  summarise(Tmin_frost_avg = mean(Tmin)/100) %>% # Mean minimum temperature of frost days
  complete(ID_coords, year, fill = list(n_frost = 0, Tmin_frost_avg = NA))

```

Additionally, there are great efforts among the governments and the scientific communities for harmonizing data from European national forest inventories (REFs UE and FunDiv, others?). Those inventories repeated in many countries along decades are usually done with spatial resolutions of few kilometers (REF). The spatial and temporal framework fits with this of the climatic database extracted with *easyclimate*, making this tool spatially useful to answer a myriad of ecological questions related to climatic changes along Europe.

# ACKNOWLEDGEMENTS

On the shoulders of giants.

# AUTHOR CONTRIBUTIONS

Please, complete this sheet with your contribution: <https://docs.google.com/spreadsheets/d/1RfrZkTbl3aaQ0M_j6qH5y4dEmvi-U3xS68qHSkEcm3s/edit#gid=0>

Use CREDIT taxonomy of author contributions: <https://rollercoaster.shinyapps.io/tenzing/>

# DATA AVAILABILITY STATEMENT

The climate datasets are publicly available at <ftp://palantir.boku.ac.at/Public/ClimateData/>. The easyclimate R package is available on CRAN (url) and GitHub (<https://github.com/VeruGHub/easyclimate>).

# REFERENCES

```{r write_citations, cache=FALSE, include=FALSE}
write.bibtex(file = "knitcitations.bib")
```

::: {#refs}
:::

\newpage

# Table 1

```{r Table-1, echo=FALSE}
kable(prec, caption = "Daily precipitation (Prcp; mm × 100) for a given point extracted with easyclimate")
```

\newpage

# Figure 1

```{r Fig-1, fig.cap="A boxplot."}

ras_tmax <- ras_tmax/100

par(mfrow = c(1, 2))
terra::plot(ras_tmax, 1, col = rev(heat.colors(20)), type = "continuous", smooth = TRUE, range = c(10, 35), legend = FALSE, mar=c(4, 2, 4, 2), main = "January 1 2012")
terra::plot(ras_tmax, 2, col = rev(heat.colors(20)), type = "continuous", smooth = TRUE, range = c(10, 35), mar = c(4, 1, 4, 3), main = "August 1 2012")

```

\newpage

# Table 2

```{r Table-2, echo=FALSE}
kable(yearclimate, digits = 1, caption = "Average climatic values for a given point extracted with easyclimate")
```

\newpage

# Table 3

```{r Table-3, echo=FALSE}
kable(springfrost, caption = "No. of days with temperature below zero in spring (n_frost) and mean minimum temperature reached (Tmin_frost_avg) extracted with easyclimate")
```
